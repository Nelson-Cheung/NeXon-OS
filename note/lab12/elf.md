# C语言编译执行

C语言程序从代码编写到程序执行需要经过预处理阶段、编译阶段、汇编阶段和链接阶段，用到的工具是gcc。

## 预处理阶段

预处理器根据以字符#开头的命令修改原始C程序，得到另一个C程序，生成的C程序通常以.i作为文件扩展名。期间所作的工作主要是文本替换、宏展开和删除注释的简单工作。预处理命令如下。

```shell
gcc -E hello.c -o hello.i
```

## 编译阶段

编译器将文本文件hello.i翻译成汇编代码hello.s，从而变成了汇编语言程序。

```shell
gcc -S hello.i -o hello.S
```

## 汇编阶段

汇编器将.s文件翻译成机器语言指令，这些指令打包生成了**可重定位目标文件**的格式，也就是生成的.o文件。

```shell
gcc -c hello.S -o hello.o
```

## 链接阶段

链接器把程序用到的外部函数的实现和程序链接到一起生成**可执行目标文件**。这些外部函数已经被单独预编译成一个个目标文件中。最后可执行文件加载到储存器后由操作系统负责执行。

# 目标文件

汇编和链接阶段都生成了目标文件，两者的区别在于

+ 可重定位目标文件：包含二进制代码和数据，其形式可以和其他目标文件进行合并，创建一个可执行目标文件。

+ 可执行目标文件：包含二进制代码和数据，可直接被加载器加载执行。





